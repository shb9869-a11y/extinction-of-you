<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>SLEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEP</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="SLEEEEEP">
<meta name="theme-color" content="#000000">

<style>
  :root{
    --appH: 100svh;
    --frame: clamp(16px, 4vmin, 40px);
    --ui-gap: 8px;

    --fs-body: clamp(12px, 2.2vmin, 16px);
    --fs-strong: clamp(14px, 2.8vmin, 20px);
    --fs-small: clamp(11px, 1.8vmin, 14px);
    --fs-name: clamp(16px,3.2vmin,22px);
    --fs-intro: clamp(14px, 2.6vmin, 17px);

    --pad-btn-y: clamp(6px, 1.1vmin, 10px);
    --pad-btn-x: clamp(10px, 1.8vmin, 20px);

    --safe-t: env(safe-area-inset-top, 0px);
    --safe-b: env(safe-area-inset-bottom, 0px);
    --safe-l: env(safe-area-inset-left, 0px);
    --safe-r: env(safe-area-inset-right, 0px);
  }

  html,body{margin:0;height:var(--appH);background:#000;overflow:hidden;touch-action:manipulation}
  body{
    font-family:Impact,"Anton","Arial Black",system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans KR",sans-serif;
    -webkit-user-select:none; user-select:none; -webkit-touch-callout:none;
  }
  *{ -webkit-user-select:none; user-select:none; -webkit-touch-callout:none; }
  input, textarea{ -webkit-user-select:text; user-select:text; }

  .fade{opacity:0; transition:opacity 1200ms ease}
  .fade.show{opacity:1}

  #view{position:fixed;left:0;top:0;width:100%;height:var(--appH);display:block;z-index:0}
  .frameBox{
    position:fixed;
    left:calc(var(--frame) + var(--safe-l));
    top:calc(var(--frame) + var(--safe-t));
    right:calc(var(--frame) + var(--safe-r));
    bottom:calc(var(--frame) + var(--safe-b));
    border:2px solid rgba(255,255,255,.22); pointer-events:none; z-index:50;
  }

  .uiBtn{background:transparent;color:#fff;border:none;font-size:var(--fs-strong);
    padding:var(--pad-btn-y) var(--pad-btn-x);font-family:"Courier New",ui-monospace,monospace;white-space:nowrap;cursor:pointer;user-select:none}
  .uiBtn.small{font-size:var(--fs-small);padding:calc(var(--pad-btn-y)*0.6) calc(var(--pad-btn-x)*0.6)}
  .hide{display:none !important;}

  .controls{
    position:fixed;
    right:calc(var(--frame) + var(--ui-gap) + var(--safe-r));
    bottom:calc(var(--frame) + var(--ui-gap) + var(--safe-b));
    z-index:400;display:flex;gap:6px;align-items:center; opacity:0; transition:opacity 1200ms ease;}
  .controls.show{opacity:1}
  .readout{min-width:48px;text-align:center;opacity:.9;font-family:"Courier New",ui-monospace,monospace;font-size:var(--fs-small);color:#ddd}

  .btn-capture{
    position:fixed;
    left:calc(var(--frame) + var(--ui-gap) + var(--safe-l));
    bottom:calc(var(--frame) + var(--ui-gap) + var(--safe-b));
    z-index:450; opacity:0; transition:opacity 1200ms ease;}
  .btn-capture.show{opacity:1}

  #runTimer{
    position:fixed;
    right:calc(var(--frame) + var(--ui-gap) + var(--safe-r));
    top:calc(var(--frame) + var(--ui-gap) + var(--safe-t));
    z-index:460;
    font-family:"Courier New",ui-monospace,monospace;
    font-size:var(--fs-strong);
    color:#fff; opacity:.95;
    pointer-events:none; user-select:none;
    display:none;
  }

  #rotateOverlay{
    position:fixed; inset:0; z-index:1000; display:none;
    align-items:center; justify-content:center; text-align:center;
    background:#000; color:#fff; padding:40px; font-family:"Courier New",ui-monospace,monospace;
  }

  /* Gate */
  #overlay{position:fixed;inset:0;z-index:300;display:flex;align-items:center;justify-content:center;padding:calc(20px + var(--safe-t)) calc(20px + var(--safe-r)) calc(20px + var(--safe-b)) calc(20px + var(--safe-l));color:#fff;background:rgba(0,0,0,.85)}
  #overlayContent{max-width:min(92vw, 72ch);font-family:"Courier New",ui-monospace,monospace;line-height:1.7;text-align:center}
  .gateLine{display:inline-block;font-family:"Courier New",ui-monospace,monospace;font-size:var(--fs-strong);border:none;background:transparent;color:#fff;cursor:pointer;padding:6px 10px}
  .gateHint{opacity:.7;margin-top:6px}

  /* Name */
  #nameOverlay{position:fixed; inset:0; z-index:260; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.85); color:#fff;}
  #nameCard{ width:min(92vw,600px); text-align:center; font-family:"Courier New",ui-monospace,monospace; }
  #nameCard h2{ margin:0 0 12px 0; letter-spacing:.08em; font-size:var(--fs-name); font-weight:400; }
  #nick{ width:100%; padding:12px 14px; background:#000; border:1px solid #555; color:#fff; font-size:var(--fs-name); outline:none; }
  #nameRow{ display:flex; gap:10px; margin-top:12px; justify-content:center; }
  #nameRow .uiBtn{ padding:10px 14px; }

  /* Preset / Welcome */
  #preset{position:fixed;inset:0;z-index:250;background:#000;display:none;cursor:pointer}
  #presetCanvas{position:absolute;left:0;top:0;width:100%;height:100%}
  #overlayWelcome{position:fixed;inset:0;z-index:220;display:none;align-items:center;justify-content:center;color:#fff;background:rgba(0,0,0,.55);padding:calc(20px + var(--safe-t)) 20px calc(20px + var(--safe-b)) 20px;}
  #welcomeCard{ text-align:center; max-width:min(92vw, 900px); }
  #welcomeCard .title{ font-size:clamp(32px, 12vmin, 120px); font-weight:900; letter-spacing:.04em; line-height:1.02; margin-bottom:8px; text-transform:uppercase; }

  /* Intro big title */
  #introBig{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; pointer-events:none; z-index:231; } 
  #introBigText{
    color:#fff; font-weight:900; letter-spacing:.06em;
    font-size:clamp(48px, 22vmin, 260px);
    text-transform:uppercase; text-align:center; white-space:nowrap;
    text-shadow:0 0 8px rgba(0,0,0,.85), 0 2px 4px rgba(0,0,0,.7);
    padding:0 .02em;
  }

  /* Intro body (레트로 대화창) */
  #introOverlay{position:fixed; inset:0; z-index:230; display:none; color:#fff; }
  #dialogueWrap{
    position:absolute; left:0; right:0;
    bottom:0; padding: max(10px, calc(8px + var(--safe-b))) 8px;
    display:flex; justify-content:center;
  }
  #dialogueBox{
    width:min(96vw, 1100px);
    background:#111;
    border:3px solid #fff;
    outline:3px solid #000; outline-offset:-6px;
    image-rendering: pixelated;
    box-shadow:0 6px 0 #333, 0 10px 24px rgba(0,0,0,.6);
    display:grid; grid-template-columns: 120px 1fr; gap:8px; padding:10px;
    align-items:center;
    font-family:"Courier New", ui-monospace, monospace;
  }
  #loaderCanvas{
    width:110px; height:88px; background:#000; border:2px solid #fff;
  }
  #dialogueText{
    min-height:64px; padding:8px 10px; background:#000; border:2px dashed #777;
    font-size:var(--fs-intro); line-height:1.7; letter-spacing:.02em;
    overflow:hidden; white-space:nowrap; text-overflow:clip;
  }

  /* FIRST SLEEP / GOOD NIGHT */
  #firstSleep,#goodNight{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; pointer-events:none; z-index:235; }
  #firstSleepText,#goodNightText{
    color:#fff; font-weight:900; letter-spacing:.06em;
    font-size:clamp(48px, 22vmin, 260px);
    text-transform:uppercase; text-align:center; white-space:nowrap;
    text-shadow:0 0 8px rgba(0,0,0,.85), 0 2px 4px rgba(0,0,0,.7);
  }

  /* NOTE 팝업(작게) */
  #notePopup{
    position:fixed; inset:0; z-index:900; display:none;
    align-items:center; justify-content:center; background:rgba(0,0,0,.72);
  }
  #noteCard{
    width:min(92vw, 640px);
    background:#0b0b0b; color:#fff; border:1px solid #333;
    padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.6);
    font-family:"Courier New",ui-monospace,monospace; line-height:1.7;
  }
  #noteCard h3{ margin:0 0 6px 0; letter-spacing:.06em; font-weight:700; font-size:clamp(15px,3vmin,20px); }
  #noteCard p{ margin:4px 0; font-size:clamp(12px,2.4vmin,16px); }
  #noteActions{ margin-top:10px; text-align:right; }
</style>
</head>
<body>
  <canvas id="view"></canvas>
  <div class="frameBox" aria-hidden="true"></div>

  <!-- 우측 하단 +/-, 좌측 하단 CAPTURE -->
  <div class="controls" id="controls">
    <button class="uiBtn small" id="zoomOut">–</button>
    <div class="readout"><span id="zoomVal">1.0×</span></div>
    <button class="uiBtn small" id="zoomIn">+</button>
  </div>
  <button id="captureBtn" class="uiBtn small btn-capture">CAPTURE</button>
  <div id="runTimer">08:00</div>

  <div id="rotateOverlay" aria-live="polite">
    <div>
      <b>Landscape mode required</b><br/>
      Please rotate your device to landscape to continue.<br/>
    </div>
  </div>

  <!-- Gate -->
  <div id="overlay" class="fade show">
    <div id="overlayContent">
      <div class="credits" style="margin-bottom:10px;">SHB, KHJ, JYS, KTK, KCW, KJS, JMJ, PHY</div>
      <button id="permGateBtn" class="gateLine" type="button">
        Tap anywhere to allow Camera, Microphone & Motion sensors
      </button>
      <div class="gateHint">After allowing, you'll move to the name screen.</div>
    </div>
  </div>

  <!-- Name -->
  <div id="nameOverlay" class="fade">
    <div id="nameCard">
      <h2>TELL ME YOUR NAME</h2>
      <input id="nick" type="text" maxlength="24" placeholder="Type your nickname" autocomplete="off" />
      <div id="nameRow">
        <button id="nameSubmit" class="uiBtn" type="button">GO</button>
      </div>
    </div>
  </div>

  <!-- Preset -->
  <div id="preset" class="fade" title="Tap to continue">
    <canvas id="presetCanvas"></canvas>
  </div>

  <!-- Welcome -->
  <div id="overlayWelcome" class="fade">
    <div id="welcomeCard">
      <div class="title">SLEEEEEEEEEEEEEEEEEEEEEEEEEP,</div>
      <div class="title">SLEEEEEEEEEEEEEEEEEEEEEEEEEP</div>
      <button id="goIntro" class="uiBtn" type="button" style="margin-top:6px">PRESS HERE TO SLEEP</button>
    </div>
  </div>

  <!-- Intro big title -->
  <div id="introBig" class="fade"><div id="introBigText">INTRODUCTION</div></div>

  <!-- Intro body: 레트로 대화창 -->
  <div id="introOverlay" class="fade">
    <div id="dialogueWrap">
      <div id="dialogueBox">
        <canvas id="loaderCanvas" width="110" height="88"></canvas>
        <div id="dialogueText"></div>
      </div>
    </div>
  </div>

  <!-- Good Night / First Sleep -->
  <div id="goodNight" class="fade"><div id="goodNightText">GOOD NIGHT</div></div>
  <div id="firstSleep" class="fade"><div id="firstSleepText">THE FIRST SLEEP</div></div>

  <!-- NOTE Popup -->
  <div id="notePopup" class="fade" role="dialog" aria-modal="true" aria-labelledby="noteTitle">
    <div id="noteCard">
      <h3 id="noteTitle">NOTE</h3>
      <p>※ “THE FIRST SLEEP”은 눈으로 타자를 인식해 나가는 챕터입니다.</p>
      <p>※ 앞으로 당신의 태블릿 위로 타자와 몇가지 흔적들이 텍스트로 제시될 것입니다.</p>
      <p>※ 당신은 내면 세계의 탐험가로써 그 흔적들을 화면 아래 ‘CAPTURE’와 ‘+’, ‘-’버튼을 눌러 포착하세요.</p>
      <p>※ 확인하셨다면, 아래 ‘OK’버튼을 눌러주세요</p>
      <div id="noteActions">
        <button id="noteOk" class="uiBtn" type="button">OK</button>
      </div>
    </div>
  </div>

<script>
(() => {
  /* ===== Helpers ===== */
  const sleep = ms => new Promise(r=>setTimeout(r,ms));
  const qs = s => document.querySelector(s);
  const nextFrame = () => new Promise(r=>requestAnimationFrame(()=>r()));
  function fadeShow(el, dur=1200, display='flex'){ el.style.display=display; el.style.opacity='0'; el.style.transition=`opacity ${dur}ms ease`; requestAnimationFrame(()=> el.style.opacity='1'); }
  function fadeHide(el, dur=1200){ el.style.transition=`opacity ${dur}ms ease`; el.style.opacity='0'; setTimeout(()=>{ el.style.display='none'; }, dur); }

  function setAppH(){ document.documentElement.style.setProperty('--appH', window.innerHeight + 'px'); }
  setAppH(); addEventListener('resize', setAppH, {passive:true});
  if (window.visualViewport){ visualViewport.addEventListener('resize', ()=>setTimeout(setAppH,50)); }

  /* ===== Orientation notice ===== */
  const rotateOverlay = qs('#rotateOverlay');
  function isPortrait(){ const vv=visualViewport; const w=vv?vv.width:innerWidth, h=vv?vv.height:innerHeight; return h>w; }
  function updateRotate(){ rotateOverlay.style.display = isPortrait() ? 'flex' : 'none'; }
  ['load','resize','orientationchange','visibilitychange'].forEach(e=> addEventListener(e, updateRotate, {passive:true}));
  updateRotate();

  /* ===== Elements ===== */
  const overlay = qs('#overlay');
  const permGateBtn = qs('#permGateBtn');
  const nameOverlay = qs('#nameOverlay');
  const nickInput = qs('#nick');
  const nameSubmit = qs('#nameSubmit');
  const preset = qs('#preset');
  const presetCanvas = qs('#presetCanvas');
  const welcome = qs('#overlayWelcome');
  const goIntroBtn = qs('#goIntro');

  const introBig = qs('#introBig');
  const introBigText = qs('#introBigText');
  const intro = qs('#introOverlay');
  const dialogueText = qs('#dialogueText');
  const loaderCanvas = qs('#loaderCanvas');

  const goodNight = qs('#goodNight');
  const firstSleep = qs('#firstSleep');
  const firstSleepText = qs('#firstSleepText');

  const controls = qs('#controls');
  const captureBtn = qs('#captureBtn');
  const zoomIn = qs('#zoomIn');
  const zoomOut = qs('#zoomOut');
  const zoomVal = qs('#zoomVal');
  const runTimer = qs('#runTimer');

  const view = qs('#view');
  const vctx = view.getContext('2d',{alpha:false});

  const notePopup = qs('#notePopup');
  const noteOk = qs('#noteOk');

  /* ===== State ===== */
  let displayName = '____';
  let ZOOM = 1.0;

  function updateZoomLabel(){ zoomVal.textContent = ZOOM.toFixed(1)+'×'; }
  updateZoomLabel();
  zoomIn.addEventListener('click', ()=>{ ZOOM=Math.min(3.0, ZOOM+0.05); updateZoomLabel(); });
  zoomOut.addEventListener('click', ()=>{ ZOOM=Math.max(0.35, ZOOM-0.05); updateZoomLabel(); });

  /* ===== Dummy camera bg (soft grayscale) ===== */
  let t0 = performance.now();
  function renderBg(){
    requestAnimationFrame(renderBg);
    const W = view.width = innerWidth * (devicePixelRatio||1);
    const H = view.height = innerHeight * (devicePixelRatio||1);
    vctx.setTransform(1,0,0,1,0,0);
    vctx.fillStyle='#000'; vctx.fillRect(0,0,W,H);
    // 간단한 흐림 배경 패턴 (카메라 자리)
    const t = (performance.now()-t0)/1000;
    for(let i=0;i<60;i++){
      const x = (Math.sin(t*0.6+i)*0.5+0.5)*W;
      const y = (Math.cos(t*0.7+i*0.6)*0.5+0.5)*H;
      vctx.fillStyle = 'rgba(255,255,255,0.03)';
      vctx.fillRect(x-120,y-70, 240, 140);
    }
  }
  renderBg();

  /* ===== Permission Gate ===== */
  function openGate(){
    fadeHide(overlay, 800);
    fadeShow(nameOverlay, 800);
    setTimeout(()=>nickInput.focus(), 60);
  }
  ['click','touchstart','pointerdown','keydown'].forEach(ev=>{
    document.addEventListener(ev, (e)=>{
      if(getComputedStyle(overlay).display!=='none'){ openGate(); }
    }, {passive:false, once:true});
  });
  permGateBtn.addEventListener('click', openGate, {passive:true});

  /* ===== Name → Preset → Welcome ===== */
  async function acceptName(){
    const v = (nickInput.value||'').trim();
    if(v) displayName = v;
    fadeHide(nameOverlay, 800);
    showPreset();
  }
  nameSubmit.addEventListener('click', acceptName);
  nickInput.addEventListener('keydown', e=>{ if(e.key==='Enter') acceptName(); });

  function showPreset(){
    preset.style.display='block'; preset.classList.add('show');
    saverInit();
  }
  function saverInit(){
    const ctx = presetCanvas.getContext('2d');
    function loop(){
      if(getComputedStyle(preset).display==='none') return;
      const w = presetCanvas.width = innerWidth * (devicePixelRatio||1);
      const h = presetCanvas.height = innerHeight * (devicePixelRatio||1);
      ctx.setTransform(1,0,0,1,0,0);
      ctx.fillStyle='#000'; ctx.fillRect(0,0,w,h);
      ctx.fillStyle='#fff';
      ctx.font='900 160px Impact, Arial Black, sans-serif';
      ctx.textAlign='center'; ctx.textBaseline='middle';
      ctx.fillText('S L E E P', w/2, h/2);
      requestAnimationFrame(loop);
    }
    loop();
  }
  preset.addEventListener('click', ()=>{
    fadeHide(preset, 800);
    fadeShow(welcome, 800);
  });

  /* ===== Intro Lines (하단 대화창) ===== */
  const introLines = [
    "안녕하세요?",
    "작게 대답해주세요.",
    "안녕하세요?",
    "대답을 해주셔야 프로그램이 진행될 수 있습니다.",
    "안녕하세요?",
    "감사합니다.",
    "지금 이 화면을 보고 있는 당신은 " + displayName + "의 내면 세계를 탐험하는 탐험가입니다.",
    "지금부터 우리는 주변의 소리에 귀를 기울이며 30분 간의 짧은 낮잠에 빠져볼 것입니다.",
    "자, 천천히 공간을 거닐어보세요.",
    "무릎을 들고, 발을 앞으로 뻗어보세요.",
    "참 잘했어요.",
    "맞아요. 그래 맞아요. 우리는 늘 그랬어요.",
    "우리는 언제나 타자와 함께 존재해 왔습니다.",
    "가족, 친구, 교수님, 지나가는 그들, 그리고 당신과 처음 만나는 저도 우리는 늘 함께 존재해왔습니다",
    "그러나 어느 순간 ‘너’로 불리던 그들은 ‘그것’으로 전락했습니다",
    "이유는 아무도 몰라요. 그저 우리가 ‘너’들을 ‘그것’들로 부르기 시작한 것이죠.",
    "이제 우리는 어느 곳에서도 ‘너’를 찾아볼 수 없습니다.",
    "그런 특정했던 ‘너’는 서서히 희미해지고 퇴색되고 잊혀지고 잃어지고 앓아가고 있습니다",
    "마치 꿈 속에서 만난 누군가가... 그게 누구였지?... 하고 떠오르지 않는 것처럼",
    "이곳은 바로 ‘너’가 사라진 공간, ‘너’를 제거해버린 " + displayName + "의 내면 세계입니다.",
    "이제 눈을 감고, 천천히 수면 아래로 내려갑니다.",
    "잠시 후, 첫 번째 수면이 시작됩니다."
  ];

  async function typeLine(line, speed=36){
    dialogueText.textContent = "";
    for(let i=0;i<line.length;i++){
      dialogueText.textContent += line[i];
      await sleep(speed);
    }
    await sleep(900);
  }

  /* 좌측 캐릭터 로딩 애니메이션 (픽셀 캐릭터가 풀숲으로 들어감) */
  let loaderStop = false;
  function startLoaderAnim(){
    loaderStop = false;
    const c = loaderCanvas, ctx = c.getContext('2d');
    const sprite = [
      "....XX....",
      "...XXXX...",
      "..XXXXXX..",
      "..X.XX.X..",
      "..XXXXXX..",
      "...X..X...",
      "..X.  .X..",
      ".X.    .X.",
      ".X.    .X.",
      "..X.  .X..",
      "...XXXX..."
    ];
    const grass = [
      "v v v v v ",
      " v v v v v",
      "v v v v v ",
      " v v v v v"
    ];
    let x = 4, y = 36, step = 2, t=0;

    function drawPixel(xp, yp, ch, cell, col){
      if(ch==='X'){ ctx.fillStyle=col; ctx.fillRect(xp, yp, cell, cell); }
    }

    function draw(){
      if(loaderStop) return;
      const cell = 4;
      ctx.fillStyle='#000'; ctx.fillRect(0,0,c.width,c.height);

      // 캐릭터
      const hop = Math.max(0, Math.sin(t*0.25)*3);
      for(let r=0;r<sprite.length;r++){
        for(let k=0;k<sprite[r].length;k++){
          const ch = sprite[r][k];
          const px = Math.floor(x + k*cell);
          const py = Math.floor(y + r*cell - hop);
          if(ch==='X') drawPixel(px, py, 'X', cell, '#ff8a3c');
        }
      }

      // 오른쪽 풀숲
      const gx0 = c.width-40;
      ctx.fillStyle='#0a0';
      for(let r=0;r<grass.length;r++){
        for(let k=0;k<grass[r].length;k++){
          if(grass[r][k]==='v'){
            const gx = gx0 + k*3;
            const gy = 54 + r*6 + (k%2?2:0);
            ctx.fillRect(gx, gy, 3, 6);
          }
        }
      }

      // 이동
      x += step;
      if(x > c.width-64){ x = 4; } // 풀숲으로 사라졌다가 왼쪽에서 재등장
      t++;
      requestAnimationFrame(draw);
    }
    draw();
  }
  function stopLoaderAnim(){ loaderStop = true; }

  /* ===== Intro Flow (요청: INTRODUCTION 페이드인 1.5초 유지 → 페이드아웃 → 대화창에서 문장 출력) ===== */
  async function showIntroFlow(){
    // INTRODUCTION 타이틀
    introBig.style.display='flex'; await nextFrame();
    introBig.style.opacity='0'; introBig.style.transition='opacity 600ms ease';
    introBig.style.opacity='1';
    await sleep(1500);
    // 본문 대화창 페이드 인
    intro.style.display='block'; intro.style.opacity='0'; intro.style.transition='opacity 900ms ease';
    requestAnimationFrame(()=>{ introBig.style.opacity='0'; intro.style.opacity='1'; });
    setTimeout(()=>{ introBig.style.display='none'; }, 900);

    // 로딩 애니 시작
    startLoaderAnim();

    // 문장 출력
    for(const raw of introLines){
      const line = raw.replaceAll("____", displayName);
      await typeLine(line, 34);
    }

    // 로딩 애니 멈춤
    stopLoaderAnim();

    // 장면 페이드아웃 → FIRST SLEEP 페이드인 (번개 삭제)
    await transitionToFirstSleep();
  }

  async function transitionToFirstSleep(){
    // 인트로 빠짐
    fadeHide(intro, 800);

    // GOOD NIGHT 잠깐 (원하면 유지)
    goodNight.style.display='flex'; await nextFrame();
    goodNight.style.opacity='0'; goodNight.style.transition='opacity 600ms ease';
    goodNight.style.opacity='1';
    await sleep(900);
    fadeHide(goodNight, 600);

    // FIRST SLEEP 페이드인 → 잠깐 유지 → 페이드아웃 → NOTE 팝업
    firstSleep.style.display='flex'; firstSleep.style.opacity='0'; firstSleep.style.transition='opacity 900ms ease';
    await nextFrame();
    firstSleep.style.opacity='1';

    // 컨트롤 in
    controls.classList.add('show'); captureBtn.classList.add('show');
    runTimer.style.display='block';

    await sleep(1400);                           // 잠깐 있다가
    firstSleep.style.opacity='0';                // 사라지고
    await sleep(900);
    firstSleep.style.display='none';

    // 팝업 표시
    showNotePopup();
  }

  function showNotePopup(){
    fadeShow(notePopup, 250, 'flex');
    setTimeout(()=> noteOk.focus(), 60);
    noteOk.onclick = ()=> fadeHide(notePopup, 250);
  }

  /* ===== Welcome → Intro ===== */
  goIntroBtn.addEventListener('click', async ()=>{
    fadeHide(welcome, 800);
    // INTRODUCTION 타이틀 먼저
    await sleep(200);
    await showIntroFlow();
  });

})();
</script>
</body>
</html>
